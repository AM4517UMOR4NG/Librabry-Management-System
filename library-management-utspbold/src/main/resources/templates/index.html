<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">

<head>
    <title>Library Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/index.css}">
</head>

<body>
    <div class="dashboard-header">
        <div class="container">
            <a th:href="@{/logout}" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i>Logout
            </a>
            <h1 class="dashboard-title">
                <i class="fas fa-book-reader me-3"></i>Library Management System
            </h1>
        </div>
    </div>

    <!-- ADMIN SPECIAL FEATURE: Dashboard Stats -->
    <div class="container" sec:authorize="hasRole('ROLE_ADMIN')">
        <div class="stats-container mb-4">
            <div class="row">
                <div class="col-md-4 stat-item">
                    <div class="stat-number" th:text="${bookCount}"></div>
                    <div class="stat-label">Total Buku</div>
                </div>
                <div class="col-md-4 stat-item">
                    <div class="stat-number" th:text="${memberCount}"></div>
                    <div class="stat-label">Total Member</div>
                </div>
                <div class="col-md-4 stat-item">
                    <div class="stat-number" th:text="${loanCount}"></div>
                    <div class="stat-label">Total Peminjaman</div>
                </div>
            </div>
        </div>
        <div class="mb-4">
            <a th:href="@{/admin/users}" class="btn btn-outline-danger btn-lg w-100 mb-3">
                <i class="fas fa-users-cog me-2"></i>Kelola User (Admin)
            </a>
        </div>
    </div>

    <!-- USER SPECIAL FEATURE: Profile & Loan History -->
    <div class="container mb-4" sec:authorize="hasRole('ROLE_USER') and !hasRole('ROLE_ADMIN')">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="d-flex flex-column align-items-center gap-3 mb-4">
                    <a th:href="@{/profile}" class="btn btn-outline-primary btn-lg w-100">
                        <i class="fas fa-user-circle me-2"></i>Profil Saya
                    </a>
                    <a th:href="@{/loans/history}" class="btn btn-outline-success btn-lg w-100">
                        <i class="fas fa-history me-2"></i>Riwayat Pinjam
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="container mb-5">
        <!-- Search Bar -->
        <form th:action="@{/}" method="get" class="mb-4">
            <div class="input-group input-group-lg shadow-sm">
                <input type="text" class="form-control" name="search" th:value="${search}"
                    placeholder="Cari buku berdasarkan judul, penulis, atau ISBN..." aria-label="Cari Buku">
                <button class="btn btn-primary" type="submit">
                    <i class="fas fa-search"></i> Cari
                </button>
            </div>
        </form>
        <!-- Book List -->
        <div class="glass-card p-3">
            <h4 class="mb-3"><i class="fas fa-book me-2"></i>Daftar Buku</h4>
            <div th:if="${#lists.isEmpty(books)}" class="text-center text-muted py-4">
                <i class="fas fa-info-circle fa-2x mb-2"></i><br />
                Tidak ada buku yang ditemukan.
            </div>
            <div th:if="${!#lists.isEmpty(books)}" class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>Judul</th>
                            <th>Penulis</th>
                            <th>Tahun</th>
                            <th>ISBN</th>
                            <th>Stok</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="book : ${books}">
                            <td><a th:href="@{/books/view/{id}(id=${book.id})}" th:text="${book.title}"
                                    class="fw-bold text-decoration-none text-primary"></a></td>
                            <td th:text="${book.author}"></td>
                            <td th:text="${book.publicationYear}"></td>
                            <td th:text="${book.isbn}"></td>
                            <td>
                                <span th:text="${book.quantity}"
                                    th:classappend="${book.quantity > 0} ? 'text-success fw-bold' : 'text-danger fw-bold'"></span>
                                <span th:if="${book.quantity == 0}" class="badge bg-danger ms-2">Habis</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Quick Stats (hidden, replaced by admin stats above) -->
        <div class="stats-container d-none">
            <div class="row">
                <div class="col-md-4 stat-item">
                    <div class="stat-number">You Decide</div>
                    <div class="stat-label">Total Books</div>
                </div>
                <div class="col-md-4 stat-item">
                    <div class="stat-number">You Decide</div>
                    <div class="stat-label">Active Members</div>
                </div>
                <div class="col-md-4 stat-item">
                    <div class="stat-number">You Decide</div>
                    <div class="stat-label">Current Loans</div>
                </div>
            </div>
        </div>

        <!-- Main Cards -->
        <div class="row">
            <div class="col-md-4">
                <div class="glass-card animate-fade-in" style="animation-delay: 0.1s">
                    <div class="card-body text-center">
                        <i class="fas fa-books card-icon"></i>
                        <h5 class="card-title">
                            <i class="fas fa-book me-2"></i>Books Management
                        </h5>
                        <p class="card-text">Kelola inventaris buku, tambahkan buku baru, perbarui atau hapus buku yang
                            ada.</p>
                        <a th:href="@{/books}" class="btn btn-danger btn-lg w-100">
                            <i class="fas fa-book me-2"></i>Kelola Buku
                        </a>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="glass-card animate-fade-in" style="animation-delay: 0.2s">
                    <div class="card-body text-center">
                        <i class="fas fa-users card-icon"></i>
                        <h5 class="card-title">Members Management</h5>
                        <p class="card-text">Kelola anggota perpustakaan, tambahkan anggota baru, perbarui informasi
                            anggota.</p>
                        <a th:href="@{/members}" class="btn btn-danger btn-lg w-100">
                            <i class="fas fa-user-plus me-2"></i>Kelola Anggota
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="glass-card animate-fade-in" style="animation-delay: 0.3s">
                    <div class="card-body text-center">
                        <i class="fas fa-handshake card-icon"></i>
                        <h5 class="card-title">Loan Management</h5>
                        <p class="card-text">Kelola peminjaman buku, lacak peminjaman dan pengembalian.</p>
                        <a th:href="@{/loans}" class="btn btn-danger btn-lg w-100">
                            <i class="fas fa-exchange-alt me-2"></i>Kelola Peminjaman
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>